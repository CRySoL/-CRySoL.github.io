---
layout: post
title: Construir paquetes debian con ian
author: ana_rubio
comments: true
category: recipe
draft: true
tags:
- debian
---

h2. Firma GPG

Para poder subir paquetes debian a un repositorio una vez compilados debes firmarlos. El repositorio de paquetes también tiene una clave. Tu clave GPG debe estar firmada con la clave del repositorio. De ese modo cualquiera que vaya a instalar un paquete puede verificar que los paquetes efectivamente corresponden a ese repositorio.

Por eso, lo primero es disponer de una clave GPG. Aquí tienes unos pasos para crearla y comprobarla, en el caso de que no tengas.

h3. Generar clave GPG

<pre class=“console”>
gpg --gen-key
</pre>

Los ficheros generados quedan en @~/.gnupg@.

Aunque no es necesario en esta receta, es conveniente exportar la clave privada y almacenarla en un lugar seguro:

<pre class=“console”>
gpg --export-secret-keys -a <huella_digital> > ~/<nombre-fichero>.asc
</pre>

h3. Listar claves

<pre class=“console”>
gpg --list-keys
</pre>

h3. Añadir clave a un servidor (ej: pgp.mit.edu) servidor

<pre class=“console”>
gpg --keyserver <servidor> --send-key <huella_digital>
</pre>


h2. Configuración de @ian@

Añadir datos en ~/.config/ian/config (para ian) o ~/.bashrc (para el sistema). Ian buscará en .bashrc la configuración que necesita si no la encuentra en ~/.config/ian/config:
    - ~/.config/ian/config
      DEBFULLNAME="Ana Rubio Ruiz"
      DEBEMAIL=ana.rubio.ruiz@gmail.com
      DEBSIGN_KEYID=<huella_digital>
      DEBREPO_URL=debrepoo@debrepo/shared

* Ian necesita que un editor por defecto (ej: emacs). En caso de no tenerlo, especificamos cuál será en ~/.config/ian/config (para Ian) o en ~/.bashrc (para el sistema). Igual que en el paso anterior, Ian buscará primero en ~/.config/ian/config:
    - ~/.config/ian/config
      EDITOR="emacs -nw"

h2. Configuración de @dupload@

Crear fichero @~/.dupload.conf@ con:

{% highlight text %}
package config;

$default_host = "debrepo";

$cfg{'debrepo'} = {
    fqdn => "debrepo",
    login => "repouser",
    method => "scpb",
    incoming => "/shared/incoming/",

    # The dinstall on ftp-master sends emails itself
    dinstall_runs => 1,
};

$postupload{'changes'} = 'ssh debrepo "reprepro -V -b /shared processincoming sid-process"';

1;  # DO NOT remove this line!
{% highlight %}

h3. Configuración de SSH para acceder al repositorio

h3. Generar clave SSH

<pre class=“console”>
ssh-keygen -b 4096
</pre>
    
    - CLAVE PÚBLICA SSH: ~/.ssh/id_rsa.pub
    - CLAVE PRIVADA SSH: ~/.ssh/id_rsa

h3. Configuración SSH

Añadir al fichero @.ssh/config@:

{% highlight text %}
Host debrepo
    Hostname debrepo.example.net
    User debrepo
    IdentityFile ~/.ssh/id_rsa
{% highlight %}

h2. Comando básicos @ian@

Fecha de última versión:
    ian release-date -y

Compilar:
    ian build -c

Subir paquete:
    ian upload
